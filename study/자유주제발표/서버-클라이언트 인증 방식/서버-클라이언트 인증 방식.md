# μ„λ²„-ν΄λΌμ΄μ–ΈνΈ μΈμ¦ λ°©μ‹

## μΏ ν‚¤ vs μ„Έμ… vs ν† ν°

### μΏ ν‚¤λ€
μΏ ν‚¤λ€ ν•μ΄νΌ ν…μ¤νΈμ κΈ°λ΅μ„(HTTP)μ μΌμΆ…μΌλ΅μ„ μΈν„°λ„· μ‚¬μ©μκ°€ μ–΄λ– ν• μ›Ήμ‚¬μ΄νΈλ¥Ό λ°©λ¬Έν•  κ²½μ° μ‚¬μ©μμ μ›Ή λΈλΌμ°μ €λ¥Ό ν†µν•΄ μΈν„°λ„· μ‚¬μ©μμ μ»΄ν“¨ν„°λ‚ λ‹¤λ¥Έ κΈ°κΈ°μ— μ„¤μΉλλ” μ‘μ€ κΈ°λ΅ μ •λ³΄ νμΌμ„ μΌμ»«λ”λ‹¤.

#### μΏ ν‚¤ ν•νƒ
Key - Value Pair

#### μΏ ν‚¤ μ €μ¥μ†
ν΄λΌμ΄μ–ΈνΈ PC (λΈλΌμ°μ € μ„¤μΉ ν΄λ” λ“±)<br>

#### μΏ ν‚¤ λ™μ‘ μ›λ¦¬

<img src="β€cookies.β€001.jpeg" style="width:600px" /><br>

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ”μ²­μ„ λ³΄λ‚Έλ‹¤.
2. μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈ μΈ΅μ— μ €μ¥ν•κ³  μ‹¶μ€ μ •λ³΄λ¥Ό μ‘λ‹µ ν—¤λ”μ Set-Cookieμ— λ‹΄λ”λ‹¤.
3. ν΄λΌμ΄μ–ΈνΈλ” μ”μ²­μ„ λ³΄λ‚Ό λ•λ§λ‹¤, λ§¤λ² μ €μ¥λ μΏ ν‚¤λ¥Ό μ”μ²­ ν—¤λ”μ Cookieμ— λ‹΄μ•„ λ³΄λ‚Έλ‹¤.<br>
μ„λ²„λ” Cookieμ— λ‹΄κΈ΄ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ ν•΄λ‹Ή μ”μ²­μ ν΄λΌμ΄μ–ΈνΈκ°€ λ„κµ°μ§€ μ‹λ³„ν•λ‹¤.

### μ„Έμ…μ΄λ€
μ„Έμ…(session)μ€ λ°μκµ¬μ μ΄κ³  μƒνΈμ‘μ©μ μΈ μ •λ³΄ κµν™μ„ μ „μ ν•λ” λ‘ μ΄μƒμ ν†µμ‹  μ¥μΉλ‚ μ»΄ν“¨ν„°μ™€ μ‚¬μ©μ κ°„μ λ€ν™”λ‚ μ†΅μμ‹  μ—°κ²°μƒνƒλ¥Ό μλ―Έν•λ” λ³΄μ•μ μΈ λ‹¤μ΄μ–Όλ΅κ·Έ(dialogue) λ° μ‹κ°„λ€λ¥Ό κ°€λ¦¬ν‚¨λ‹¤.<br>
λ”°λΌμ„ μ„Έμ…μ€ μ—°κ²°μƒνƒλ¥Ό μ μ§€ν•λ” κ²ƒλ³΄λ‹¤ μ—°κ²°μƒνƒμ μ•μ •μ„±μ„ λ” μ¤‘μ”μ‹ ν•κ² λλ‹¤.

#### μ„Έμ… ν•νƒ
Key - Value Pair

#### μ„Έμ… μ €μ¥μ†
- ν†°μΊ£μ μ„Έμ… μ €μ¥μ†(ν†°μΊ£ λ©”λ¨λ¦¬ κ³µκ°„ λ‚΄λ¶€μ— μμ)<br>
-> 2λ€ μ΄μƒμ WASμ κµ¬λ™λλ” ν™κ²½μ—μ„λ” ν†°μΊ£ κ°„ μ„Έμ… κ³µμ λ¥Ό μ„ν• μ„¤μ •μ΄ ν•„μ”ν•¨
- ν•λ“λ””μ¤ν¬
- λ°μ΄ν„°λ² μ΄μ¤<br>
- Redis, Memcached κ°™μ€ λ©”λ¨λ¦¬ DB
- Spring Session JDBC

#### μ„Έμ… λ™μ‘ μ›λ¦¬

<img src="β€session.β€001.jpeg" style="width:600px" /><br>

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ”μ²­μ„ ν•λ©΄ Sessionμ΄ μ„λ²„ λ©”λ¨λ¦¬(νΉμ€ λ°μ΄ν„°λ² μ΄μ¤) μƒμ— μ €μ¥λλ‹¤. 
2. μ„Έμ…μ„ μ‹λ³„ν•κΈ° μ„ν• Session IDλ¥Ό κΈ°μ¤€μΌλ΅ μ •λ³΄λ¥Ό μ €μ¥ν•κ³  Session IDλ¥Ό λΈλΌμ°μ € Cookieμ— μ €μ¥ν•λ‹¤.
3. Cookieμ— Session μ •λ³΄κ°€ λ‹΄κ²¨μκΈ° λ•λ¬Έμ— λΈλΌμ°μ €λ” ν•΄λ‹Ή μ‚¬μ΄νΈμ— λ€ν• λ¨λ“  Requestμ— Session IDλ¥Ό λ‹΄μ•„μ„ μ „μ†΅ν•λ‹¤.
4. μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ Session IDμ™€ μ„Έμ… μ €μ¥μ†μ—μ„ κ΄€λ¦¬ν•κ³  μλ” Session IDλ¥Ό λΉ„κµν•μ—¬ ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‹λ³„ν•λ‹¤.

### ν† ν°μ΄λ€
μ‚¬μ „μ  μλ―Έλ΅λ” κ°μΈμ •λ³΄μ™€ κ°™μ€ λ°μ΄ν„°λ¥Ό λ‹¤λ¥Έ λ°μ΄ν„°λ΅ λ€μ²΄ν•μ—¬ ν‘ν„ν•λ”λ° μ‚¬μ©λλ” λ°μ΄ν„°λΌκ³  λμ–΄ μλ‹¤.<br>
ν† ν° κΈ°λ° μΈμ¦ μ‹μ¤ν…μ—μ„ μΈμ¦ λ°›μ€ μ‚¬μ©μμ—κ² ν† ν°μ„ λ°κΈ‰ν•κ³  μ΄λ¥Ό μ΄μ©ν•μ—¬ μ‚¬μ©μ μΈμ¦μ„ ν•λ” λ°©λ²•μ— μ‚¬μ©λλ‹¤.

#### ν† ν° μ €μ¥μ†
ν΄λΌμ΄μ–ΈνΈ (μΏ ν‚¤, μ„Έμ… μ¤ν† λ¦¬μ§€, λ΅μ»¬ μ¤ν† λ¦¬μ§€)

#### ν† ν° λ™μ‘ μ›λ¦¬

<img src="β€token.β€001.jpeg" /><br>

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ”μ²­μ„ ν•λ©΄ μ„λ²„ μΈ΅μ—μ„λ” ν΄λΌμ΄μ–ΈνΈμ—κ² μ μΌν• Tokenμ„ λ°κΈ‰ν•λ‹¤.
2. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„ μΈ΅μ—μ„ μ „λ‹¬λ°›μ€ Tokenμ„ μΏ ν‚¤λ‚ μ¤ν† λ¦¬μ§€μ— μ €μ¥ν•΄ λ‘κ³ , μ„λ²„μ— μ”μ²­μ„ ν•  λ•λ§λ‹¤ ν•΄λ‹Ή Tokenμ„ HTTP μ”μ²­ ν—¤λ”μ— ν¬ν•¨μ‹μΌ μ „λ‹¬ν•λ‹¤.
3. μ„λ²„λ” μ „λ‹¬λ°›μ€ Tokenμ„ κ²€μ¦ν•κ³  μ”μ²­μ— μ‘λ‹µν•λ‹¤.<br>
Tokenμ€ ν΄λΌμ΄μ–ΈνΈμ—μ„ κ΄€λ¦¬ν•κΈ° λ•λ¬Έμ— μ„λ²„ λ©”λ¨λ¦¬λ‚ DBλ¥Ό μ΅°νν•  ν•„μ”κ°€ μ—†λ‹¤.

### μΏ ν‚¤ vs μ„Έμ… vs ν† ν° λΉ„κµ

| κµ¬λ¶„ | μΏ ν‚¤ | μ„Έμ… | ν† ν° |
| --- | --- | --- | --- |
| ν•νƒ | KEY - VALUE PAIR | KEY - VALUE PAIR | DATA |
| κ΄€λ¦¬μ£Όμ²΄ | CLIENT | SERVER | CLIENT |
| ν•κ³„ | λ³΄μ• μ·¨μ•½<br> μ©λ‰ μ ν•<br> λΈλΌμ°μ € κ°„ κ³µμ  λ¶κ°€λ¥<br> λ„¤νΈμ›ν¬ λ¶€ν• λ°μƒ| μ„Έμ… ID μμ²΄ νƒμ·¨ κ°€λ¥μ„±<br> μ„λ²„ λ¶€ν• | λ„¤νΈμ›ν¬ λ¶€ν•<br> μ¤‘μ” μ •λ³΄ μ‚¬μ© X<br> ν† ν° νƒμ·¨ μ‹ λ€μ² μ–΄λ ¤μ›€ |

## JWT (JSON Web Token)

### JWTμ΄λ€
JWT(JSON Web Token)μ΄λ€ μΈμ¦μ— ν•„μ”ν• μ •λ³΄λ“¤μ„ μ•”νΈν™”μ‹ν‚¨ JSON Tokenμ„ μλ―Έν•λ‹¤.<br>
JWT κΈ°λ° μΈμ¦μ€ JWT Token(Access Token)μ„ HTTP Headerμ— λ‹΄μ•„ ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‹λ³„ν•λ” λ°©μ‹μ΄λ‹¤.

#### JWT κµ¬μ΅°
<img src="jwt_structure.jpg" style="width:500px;" /><br>

#### ν—¤λ”(Header)
<pre><code>{
    "alg": "HS256", // μ„λ… μ•κ³ λ¦¬μ¦ (HMAC SHA256 or RSA)
    "typ": "JWT" // νƒ€μ…
}</code></pre>

μ„μ JSONμ„ Base64Url Encoding ν•λ‹¤.

#### λ‚΄μ©(Payload)
Payloadμ—λ” claimsμ΄ ν¬ν•¨λμ–΄ μλ”λ°, claimsμ΄λ€ μ μ €μ μ •λ³΄λ¥Ό κ°€μ§€κ³  μλ” dataλ¥Ό λ§ν•λ‹¤.

#### Claims
1. Registered claims: μ‚¬μ „μ— μ •μλ ν΄λ μ„<br>
&nbsp;-&nbsp; iss (issuer; λ°ν–‰μ)<br>
&nbsp;-&nbsp; exp (expiration time; λ§λ£ μ‹κ°„)<br>
&nbsp;-&nbsp; sub (subject; μ λ©)<br>
&nbsp;-&nbsp; aud (audience; μμ‹ μ μ‹λ³„ λ¬Έμμ—΄) λ“±.
2. Public claims: μ‚¬μ©μκ°€ μ •μν•  μ μμΌλ‚ μ¶©λμ„ λ°©μ§€ν•κΈ° μ„ν•΄ IANA JSON Web Token Registryμ—μ„ μ •μν• λ€λ΅ μ‚¬μ©ν•κ±°λ‚ URI ν•μ‹μΌλ΅ μ •μν•΄μ•Ό ν•λ‹¤.
3. Private claims: μ‚¬μ©μ„ λ™μν• λ‹Ήμ‚¬μλ“¤ κ°„μ— μ •λ³΄λ¥Ό κ³µμ ν•κΈ° μ„ν•΄ μƒμ„±ν• μ‚¬μ©μ μ •μ ν΄λ μ„μΌλ΅ κ³µκ°μ© ν΄λ μ„μ΄ μ•„λ‹λ‹¤.

<br>
<pre><code>{
    "sub": "1234567890",
    "name": "John Doe",
    "admin": true
}</code></pre>

μ„μ JSONμ„ Base64Url Encoding ν•λ‹¤.

#### μ„λ…(Signature)
μ„λ…μ€ μΈμ½”λ”© λ Headerμ™€ Payload, μ„λ²„μ Secrect Keyλ¥Ό κ²°ν•©ν•μ—¬ Headerμ—μ„ μ‚¬μ©ν• μ•κ³ λ¦¬μ¦μΌλ΅ μƒμ„±ν•λ‹¤.

Headerμ™€ Payloadλ” λ³µνΈν™”κ°€ κ°€λ¥ν•μ—¬ μ΅°μ‘ν•  μ μμ§€λ§ μ„λ²„μ Secrect Keyλ΅ μΈν•΄ ν† ν°μ΄ λ³€μ΅°λμ§€ μ•μ•μμ„ ν™•μΈν•λ”λ° μ‚¬μ©λλ‹¤.<br>
-> Signature μ•μ— μμ • μ „μ Headerμ™€ Payload κ°’μ΄ μκΈ° λ•λ¬Έμ— μ„λ²„μ Secrect Keyλ¥Ό λ¨λ¥΄λ©΄ λ‘κ°™μ€ κ°’μΌλ΅ λ³€μ΅°ν•  μ μ—†λ‹¤.

<br>
<pre><code>HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)</code></pre>

<br>
<img src="jwt_encoded_decoded.png" /><br><br>

#### μΈμ¦ κ³Όμ •

<img src="β€access_token_refresh_token.β€001.jpeg" /><br>

1. μ‚¬μ©μκ°€ ID, PWλ¥Ό μ…λ ¥ν•μ—¬ μ„λ²„μ— λ΅κ·ΈμΈ μΈμ¦μ„ μ”μ²­ν•λ‹¤.
2. λ΅κ·ΈμΈμ— μ„±κ³µν•λ©΄ μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ—κ² Access Tokenκ³Ό Refresh Tokenμ„ μƒμ„±ν•μ—¬ μΏ ν‚¤μ— λ‹΄μ•„ μ „λ‹¬ν•λ‹¤.
3. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„λ΅λ¶€ν„° λ°›μ€ JWTλ¥Ό λ΅μ»¬ μ¤ν† λ¦¬μ§€μ— μ €μ¥ν•λ‹¤. (μΏ ν‚¤λ‚ λ‹¤λ¥Έ κ³³μ— μ €μ¥ν•  μλ„ μμ)
4. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ— μ”μ²­ν•  λ•λ§λ‹¤ μ”μ²­ ν—¤λ”μ— Access Tokenμ„ λ‹΄μ•„ μ „μ†΅ν•λ‹¤.
5. λ§μΌ Access Tokenμ μ ν¨ κΈ°κ°„μ΄ λ§λ£λλ©΄ ν΄λΌμ΄μ–ΈνΈλ” μ”μ²­ ν—¤λ”μ— Refresh Tokenμ„ λ‹΄μ•„ μ „μ†΅ν•λ‹¤.
6. μ„λ²„λ” Refresh Tokenμ μ ν¨μ„±μ„ κ²€μ¦ν•κ³  μƒλ΅μ΄ Access Tokenμ„ λ°κΈ‰ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬ν•λ‹¤.

#### Access Tokenκ³Ό Refresh Token
* Access Token<br>
&nbsp;-&nbsp;&nbsp;μ‚¬μ©μμ μΈμ¦κ³Ό μμ›μ— λ€ν• μ ‘κ·Όμ„ μ„ν• ν† ν°μ΄λ‹¤.

* Refresh Token<br>
&nbsp;-&nbsp;&nbsp;Access Tokenμ κ°±μ‹ κ³Ό μ„Έμ… κ΄€λ¦¬λ¥Ό μ„ν•΄ μ‚¬μ©λλ” ν† ν°μ΄λ‹¤.

#### Bearer Schema

μΌλ°μ μΌλ΅ ν† ν°μ€ μ”μ²­ ν—¤λ”μ Authorization ν•„λ“μ— λ‹΄μ•„μ Έ λ³΄λ‚΄μ§‘λ‹λ‹¤.

> Authorization: Bearer &lt;credentials&gt;

ν† ν°μ—λ” λ§μ€ μΆ…λ¥κ°€ μκ³  μ„λ²„λ” λ‹¤μ–‘ν• μΆ…λ¥μ ν† ν°μ„ μ²λ¦¬ν•κΈ° μ„ν•΄ μ „μ†΅λ°›μ€ typeμ— λ”°λΌ ν† ν°μ„ λ‹¤λ¥΄κ² μ²λ¦¬ν•©λ‹λ‹¤.

#### μΈμ¦ νƒ€μ…
1. Basic<br>
μ‚¬μ©μ μ•„μ΄λ””μ™€ μ•”νΈλ¥Ό Base64λ΅ μΈμ½”λ”©ν• κ°’μ„ ν† ν°μΌλ΅ μ‚¬μ©ν•λ‹¤. (RFC 7617)

2. Bearer<br>
JWT νΉμ€ OAuthμ— λ€ν• ν† ν°μ„ μ‚¬μ©ν•λ‹¤. (RFC 6750)

3. Digest<br>
μ„λ²„μ—μ„ λ‚μ λ°μ΄ν„° λ¬Έμμ—΄μ„ ν΄λΌμ΄μ–ΈνΈμ— λ³΄λ‚Έλ‹¤. ν΄λΌμ΄μ–ΈνΈλ” μ‚¬μ©μ μ •λ³΄μ™€ nonceλ¥Ό ν¬ν•¨ν•λ” ν•΄μ‹κ°’μ„ μ‚¬μ©ν•μ—¬ μ‘λ‹µν•λ‹¤ (RFC 7616)

4. HOBA<br>
μ „μ μ„λ… κΈ°λ° μΈμ¦ (RFC 7486)

5. Mutual<br>
μ•”νΈλ¥Ό μ΄μ©ν• ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ μƒνΈ μΈμ¦ (draft-ietf-httpauth-mutual)

6. AWS4-HMAC-SHA256<br>
AWS μ „μ μ„λ… κΈ°λ° μΈμ¦ (λ§ν¬)

#### μ¶μ²
- https://inpa.tistory.com/entry/WEB-π“-JWTjson-web-token-λ€-π’―-μ •λ¦¬
- https://jwt.io/introduction
- https://velog.io/@cada/%ED%86%A0%EA%B7%BC-%EA%B8%B0%EB%B0%98-%EC%9D%B8%EC%A6%9D%EC%97%90%EC%84%9C-bearer%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C
- https://parkjh7764.tistory.com/211
- https://ko.wikipedia.org/wiki/HTTP_μΏ ν‚¤<br>
- https://oxylabs.io/blog/what-are-http-cookies
- https://ko.wikipedia.org/wiki/μ„Έμ…_(μ»΄ν“¨ν„°_κ³Όν•™)
- <a href="https://www.flaticon.com/kr/free-icons/" title="μ»΄ν“¨ν„° μ•„μ΄μ½">μ»΄ν“¨ν„° μ•„μ΄μ½  μ μ‘μ: Vectoricons - Flaticon</a>
- <a href="https://www.flaticon.com/kr/free-icons/" title="μ„λ²„ μ•„μ΄μ½">μ„λ²„ μ•„μ΄μ½  μ μ‘μ: juicy_fish - Flaticon</a>
